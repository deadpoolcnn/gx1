<!DOCTYPE html>
<html>
    <head>
        <title>广西军民一体化应急救援航空服务云</title>
        <meta charset="UTF-8">
        <link rel="shortcut icon" href="custom/images/favicon.ico?v=2" />
        <style>
            html, body {
                padding: 0px;
                margin: 0px;
            }
        </style>

        <script src='libs/core/ht.js'></script>
        <script src='libs/plugin/ht-edgetype.js'></script>
        <script src='libs/plugin/ht-obj.js'></script>
        <script src='libs/core/ht-ui.js'></script>
        <script src='libs/plugin/ht-vector.js'></script>
        <script src="libs/plugin/ht-animation.js"></script>

        <script>
            function init() {
                dataModel = new ht.DataModel();
                graphView = new ht.graph.GraphView(dataModel);
                graphView.addToDOM();
                dataModel.enableAnimation();

                ht.Default.xhrLoad('displays/junminronghe/hangkongfuwu.json', function(text) {
                    var json = ht.Default.parse(text);
                    if(json.title) document.title = json.title;
                    dataModel.deserialize(json);
                    graphView.fitContent(true);
                    mapAni(dataModel);
                    dibiaoAni(dataModel);
                    imgAni(dataModel);
                    kuangAni(dataModel);
                    showMenu(dataModel);
                });

                function mapAni(dm) {
                    const circle1 = dm.getDataByTag('circle1');
                    const circle2 = dm.getDataByTag('circle2');
                    const circle3 = dm.getDataByTag('circle3');
                    const circle4 = dm.getDataByTag('circle4');
                    //const circle5 = dm.getDataByTag('circle5');
                    
                    circle1.setAnimation({
                        expandWidth: {
                            property: "width",
                            from: circle1.getWidth(), 
                            to: circle1.getWidth() - 100,
                            duration: 2000,
                            next: "collapseWidth"
                        },
                        collapseWidth: {
                            property: "width",
                            from: circle1.getWidth() - 100,
                            to: circle1.getWidth(),
                            duration: 2000,
                            next: "expandWidth"
                        },
                        expandHeight: {
                            property: "height",
                            from: circle1.getHeight(), 
                            to: circle1.getHeight() - 100,
                            duration: 2000,
                            next: "collapseHeight"
                        },
                        collapseHeight: {
                            property: "height",
                            from: circle1.getHeight() - 100,
                            to: circle1.getHeight(),
                            duration: 2000,
                            next: "expandHeight"
                        },
                        show: {
                            property: "opacity",
                            accessType: "style",
                            from: 1,
                            to: 0,
                            duration: 2000,
                            next: 'opa',
                        },
                        opa: {
                            property: "opacity",
                            accessType: "style",
                            from: 0,
                            to: 1,
                            duration: 2000,
                            next: 'show',
                        },
                        start: ["expandWidth", "expandHeight","show"]
                    })
                    circle2.setAnimation({
                        expandWidth: {
                            property: "width",
                            from: circle2.getWidth(), 
                            to: circle2.getWidth() - 100,
                            duration: 2000,
                            next: "collapseWidth"
                        },
                        collapseWidth: {
                            property: "width",
                            from: circle2.getWidth() - 100,
                            to: circle2.getWidth(),
                            duration: 2000,
                            next: "expandWidth"
                        },
                        expandHeight: {
                            property: "height",
                            from: circle2.getHeight(), 
                            to: circle2.getHeight() - 100,
                            duration: 2000,
                            next: "collapseHeight"
                        },
                        collapseHeight: {
                            property: "height",
                            from: circle2.getHeight() - 100,
                            to: circle2.getHeight(),
                            duration: 2000,
                            next: "expandHeight"
                        },
                        show: {
                            property: "opacity",
                            accessType: "style",
                            from: 1,
                            to: 0,
                            duration: 2000,
                            next: 'opa',
                        },
                        opa: {
                            property: "opacity",
                            accessType: "style",
                            from: 0,
                            to: 1,
                            duration: 2000,
                            next: 'show',
                        },
                        start: ["expandWidth", "expandHeight","show"]
                    })
                    circle3.setAnimation({
                        expandWidth: {
                            property: "width",
                            from: circle3.getWidth(), 
                            to: circle3.getWidth() - 100,
                            duration: 2000,
                            next: "collapseWidth"
                        },
                        collapseWidth: {
                            property: "width",
                            from: circle3.getWidth() - 100,
                            to: circle3.getWidth(),
                            duration: 2000,
                            next: "expandWidth"
                        },
                        expandHeight: {
                            property: "height",
                            from: circle3.getHeight(), 
                            to: circle3.getHeight() - 100,
                            duration: 2000,
                            next: "collapseHeight"
                        },
                        collapseHeight: {
                            property: "height",
                            from: circle3.getHeight() - 100,
                            to: circle3.getHeight(),
                            duration: 2000,
                            next: "expandHeight"
                        },
                        show: {
                            property: "opacity",
                            accessType: "style",
                            from: 1,
                            to: 0,
                            duration: 2000,
                            next: 'opa',
                        },
                        opa: {
                            property: "opacity",
                            accessType: "style",
                            from: 0,
                            to: 1,
                            duration: 2000,
                            next: 'show',
                        },
                        start: ["expandWidth", "expandHeight","show"]
                    })
                    circle4.setAnimation({
                        expandWidth: {
                            property: "width",
                            from: circle4.getWidth(), 
                            to: circle4.getWidth() - 100,
                            duration: 2000,
                            next: "collapseWidth"
                        },
                        collapseWidth: {
                            property: "width",
                            from: circle4.getWidth() - 100,
                            to: circle4.getWidth(),
                            duration: 2000,
                            next: "expandWidth"
                        },
                        expandHeight: {
                            property: "height",
                            from: circle4.getHeight(), 
                            to: circle4.getHeight() - 100,
                            duration: 2000,
                            next: "collapseHeight"
                        },
                        collapseHeight: {
                            property: "height",
                            from: circle4.getHeight() - 100,
                            to: circle4.getHeight(),
                            duration: 2000,
                            next: "expandHeight"
                        },
                        show: {
                            property: "opacity",
                            accessType: "style",
                            from: 1,
                            to: 0,
                            duration: 2000,
                            next: 'opa',
                        },
                        opa: {
                            property: "opacity",
                            accessType: "style",
                            from: 0,
                            to: 1,
                            duration: 2000,
                            next: 'show',
                        },
                        start: ["expandWidth", "expandHeight","show"]
                    })
                    /*circle5.setAnimation({
                        expandWidth: {
                            property: "width",
                            from: circle5.getWidth(), 
                            to: circle5.getWidth() - 30,
                            duration: 2000,
                            next: "collapseWidth"
                        },
                        collapseWidth: {
                            property: "width",
                            from: circle5.getWidth() - 30, 
                            to: circle5.getWidth(),
                            duration: 2000,
                            next: "expandWidth"
                        },
                        expandHeight: {
                            property: "height",
                            from: circle5.getHeight(), 
                            to: circle5.getHeight() - 30,
                            duration: 2000,
                            next: "collapseHeight"
                        },
                        collapseHeight: {
                            property: "height",
                            from: circle5.getHeight() - 30,
                            duration: 2000,
                            to: circle5.getHeight(),
                            next: "expandHeight"
                        },
                        start: ["expandWidth", "expandHeight"]
                    })*/
                }

                function dibiaoAni(dm) {
                    var biaohong = [];
                    for(let i = 1;i<=39;i++){
                        var dibiao = dm.getDataByTag('dibiao'+i)
                        biaohong.push(dibiao)
                    }
                    for(let i = 0; i < biaohong.length; i++){
                        biaohong[i].setAnimation({
                            hide: {
                                    property: "opacity",
                                    accessType: "style", 
                                    from: 1, 
                                    to: 0,
                                    duration: 1000,
                                    next: "show"
                                },
                                show: {
                                    property: "opacity",
                                    accessType: "style", 
                                    from: 0, 
                                    to: 1,
                                    duration: 2000,
                                    next: "hide"
                                },
                            start: ["hide"]
                        })
                    }
                }

                // this.timer2 = setTimeout(() => {
                //         console.log('timeout')
                //         count = 0;
                //         // clearInterval()
                //         timer1();
                // }, 2000);
                function timer2() {
                    setTimeout(() => {
                        count = 0;
                        // clearInterval()
                        imgAni(dataModel)
                    }, 2000);
                }
                function imgAni(dm) {
                    const slide = dm.getDataByTag('slide_block');
                    var count = 0;
                    timer1 = setInterval(() => {
                        if(count === 510){
                            clearInterval(timer1)
                            timer2();
                        }
                        count++;
                        var slideBeforeOffset = slide.a('offset');
                        slide.a('offset',slideBeforeOffset-1);
                    },10);   
                }
                // 框浮动
                function kuangAni(dm) {
                    var kuang = dm.getDataByTag('kuang');
                    kuang.setAnimation({
                        up:{
                            from: kuang.getPosition().y,
                            to: kuang.getPosition().y - 10,
                            duration: 1000,
                            next: 'down',
                            onUpdate: function (value) {
                                this.setPosition(this.getPosition().x,value);
                            }
                        },
                        down:{
                            from: kuang.getPosition().y - 10,
                            to: kuang.getPosition().y,
                            duration: 1000,
                            next: 'up',
                            onUpdate: function (value) {
                                this.setPosition(this.getPosition().x,value);
                            }
                        },
                        show: {
                            property: "opacity",
                            accessType: "style",
                            from: 1,
                            to: 0.5,
                            duration: 1500,
                            next: "opa"
                        },
                        opa: {
                            property: "opacity",
                            accessType: "style",
                            from: 0.5,
                            to: 1,
                            duration: 1500,
                            next: "show"
                        },
                        start: ['show']
                    })
                }
                // 展示菜单
                function showMenu(dm) {
                    const menu = dm.getDataByTag('menu');
                    const background = dm.getDataByTag('background');
                    var menuList = [];
                    for (var i=1; i< 10; i++) {
                        menuList.push(dm.getDataByTag('menu'+i));
                    }
                    menu.s('onEnter',()=>{
                        background.s('2d.visible',true);
                        menuList.map((item)=> {
                            item.s('2d.visible',true);
                        })
                    })
                    menu.s('onClick',()=>{
                        background.s('2d.visible',false);
                        menuList.map((item)=> {
                            item.s('2d.visible',false);
                        })
                    })
                }

            }

            
        </script>
    </head>
    <body onload='setTimeout(init, 300)'>
    </body>
</html>
